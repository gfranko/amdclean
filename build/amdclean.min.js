!function(e,n){"use strict";"function"==typeof define&&define.amd?(n.env="undefined"!=typeof exports?"node":"web",n.amd=!0,define(["esprima","estraverse","escodegen","underscore"],function(r,t,a,i){return n({esprima:r,estraverse:t,escodegen:a,underscore:i},e)})):"undefined"!=typeof exports?(n.env="node",module.exports=n(null,e)):(n.env="web",e.amdclean=n(null,e))}(this,function cleanamd(amdDependencies,scope){"use strict";amdDependencies=amdDependencies||{};var codeEnv=cleanamd.env,that=scope,esprima=function(){return cleanamd.amd&&amdDependencies.esprima&&amdDependencies.esprima.parse?amdDependencies.esprima:that&&that.esprima&&that.esprima.parse?that.esprima:"node"===codeEnv?require("esprima"):void 0}(),estraverse=function(){return cleanamd.amd&&amdDependencies.estraverse&&amdDependencies.estraverse.traverse?amdDependencies.estraverse:that&&that.estraverse&&that.estraverse.traverse?that.estraverse:"node"===codeEnv?require("estraverse"):void 0}(),escodegen=function(){return cleanamd.amd&&amdDependencies.escodegen&&amdDependencies.escodegen.generate?amdDependencies.escodegen:that&&that.escodegen&&that.escodegen.generate?that.escodegen:"node"===codeEnv?require("escodegen"):void 0}(),_=function(){return cleanamd.amd&&amdDependencies.underscore?amdDependencies.underscore:that&&that._?that._:"node"===codeEnv?require("lodash"):void 0}(),fs="node"===codeEnv?require("fs"):{},publicAPI={VERSION:"1.4.0",defaultOptions:{code:"",filePath:"",globalModules:[],globalObject:!1,globalObjectName:"amdclean",esprima:{comment:!0,loc:!0,range:!0,tokens:!0},escodegen:{comment:!0},commentCleanName:"amdclean",ignoreModules:[],removeModules:[],removeAllRequires:!1,removeUseStricts:!0,shimOverrides:{},rememberGlobalObject:!0,prefixMode:"standard",prefixTransform:function(e){return e},wrap:{start:"",end:""}},env:codeEnv,errorMsgs:{emptyCode:"There is no code to generate the AST with",emptyAst:function(e){return"An AST is not being passed to the "+e+"() method"},invalidObject:function(e){return"An object is not being passed as the first parameter to the "+e+"() method"},lodash:"There is not an _.isPlainObject() method.  Make sure you have included lodash (https://github.com/lodash/lodash).",esprima:"There is not an esprima.parse() method.  Make sure you have included esprima (https://github.com/ariya/esprima).",estraverse:"There is not an estraverse.replace() method.  Make sure you have included estraverse (https://github.com/Constellation/estraverse).",escodegen:"There is not an escodegen.generate() method.  Make sure you have included escodegen (https://github.com/Constellation/escodegen)."},dependencyBlacklist:{require:!0,exports:!0,module:!0},readFile:function(e){return"node"!==publicAPI.env?"":fs.readFileSync(e,"utf8")},isDefine:function(e){var n=e.expression||{},r=n.callee;return _.isObject(e)&&"ExpressionStatement"===e.type&&_.isObject(n)&&"CallExpression"===n.type&&"Identifier"===r.type&&"define"===r.name},isRequire:function(e){var n=e.expression||{},r=n.callee;return _.isObject(e)&&"ExpressionStatement"===e.type&&_.isObject(n)&&"CallExpression"===n.type&&"Identifier"===r.type&&"require"===r.name},isRequireExpression:function(e){return"CallExpression"===e.type&&e.callee&&"require"===e.callee.name},isObjectExpression:function(e){return e&&_.isPlainObject(e)&&"ObjectExpression"===e.type},isFunctionExpression:function(e){return e&&_.isPlainObject(e)&&"FunctionExpression"===e.type},isFunctionCallExpression:function(e){return e&&_.isPlainObject(e)&&"CallExpression"===e.type&&_.isPlainObject(e.callee)&&"FunctionExpression"===e.callee.type},isUseStrict:function(e){return e&&_.isPlainObject(e)&&"Literal"===e.type&&"use strict"===e.value},isAMDConditional:function(e){if(e&&"IfStatement"!==e.type||!_.isObject(e.test)||!_.isObject(e.test.left)||_.isNull(e.test.left.value))return!1;var n={left:{operator:"typeof",argument:{type:"Identifier",name:"define"}},right:{type:"Literal",value:"function"}};return _.where(e.test,n).length||_.where([e.test],n).length||_.where(e.test.left,n).length||_.where([e.test.left],n).length},arrayContains:function(e,n){return _.isArray(e)?-1!==e.indexOf(n):!1},convertToCamelCase:function(e,n){return n=n||"_",e.replace(new RegExp(n+"(.)","g"),function(e,n){return n.toUpperCase()})},prefixReservedWords:function(name){var reservedWord=!1;try{name.length&&eval("var "+name+" = 1;")}catch(e){reservedWord=!0}return reservedWord===!0?"_"+name:name},normalizeModuleName:function(e){var n,r,t,a=publicAPI.options.prefixMode,i=publicAPI.options.prefixTransform;return e=e||"","{}"===e?e:(n=publicAPI.prefixReservedWords(e.replace(/\./g,"").replace(/[^A-Za-z0-9_$]/g,"_").replace(/^_+/,"")),r="camelCase"===a?publicAPI.convertToCamelCase(n):n,_.isFunction(i)&&(t=i(r),_.isString(t)&&t.length)?t:r)},returnExpressionIdentifier:function(e){return{type:"ExpressionStatement",expression:{type:"Identifier",name:e,range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]}},convertToObjectDeclaration:function(e,n){var r=(e.node,e.moduleName),t=function(){var r,t,a,i,o,s;return"functionCallExpression"===n&&(r=e.moduleReturnValue,t=r.callee,a=t.params,a&&a.length&&_.isArray(a)&&_.where(a,{name:"global"})&&_.isObject(t.body)&&_.isArray(t.body.body)&&(i=_.where(t.body.body,{type:"ReturnStatement"})[0],_.isObject(i)&&_.isObject(i.argument)&&"FunctionExpression"===i.argument.type&&(s=i.argument,_.isObject(s.body)&&_.isArray(s.body.body)&&(o=_.where(s.body.body,{type:"ReturnStatement"})[0],_.isObject(o.argument)&&_.isObject(o.argument.right)&&_.isObject(o.argument.right.property)&&o.argument.right.property.name&&(r={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"window",range:[0,0],loc:[0,0]},property:{type:"Identifier",name:o.argument.right.property.name,range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]}))))),r=r||e.moduleReturnValue}(),a=publicAPI.options,i=function(){return a.globalObject===!0&&a.globalObjectName?{type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:a.globalObjectName,range:[0,0],loc:[0,0]},property:{type:"Literal",value:r,raw:""+r,range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]},right:t,range:[0,0],loc:[0,0]}}:{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:r,range:[0,0],loc:[0,0]},init:t,range:[0,0],loc:[0,0]}],kind:"var",range:[0,0],loc:[0,0]}}();return i},convertToIIFE:function(e){var n=e.callbackFuncParams,r=e.callbackFunc,t=e.dependencyNames;return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:null,params:n,defaults:[],body:r.body,rest:r.rest,generator:r.generator,expression:r.expression,range:r.range||[0,0],loc:r.loc||[0,0]},arguments:t,range:r.range||[0,0],loc:r.loc||[0,0]},range:r.range||[0,0],loc:r.loc||[0,0]}},convertToIIFEDeclaration:function(e){var n=e.moduleName,r=e.callbackFuncParams,t=e.isOptimized,a=function(){var n=e.callbackFunc;return"Identifier"===n.type&&"undefined"!==n.name&&(n={type:"FunctionExpression",id:null,params:[],defaults:[],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:n.name,range:n.range||[0,0],loc:n.loc||[0,0]},arguments:[],range:n.range||[0,0],loc:n.loc||[0,0]},range:n.range||[0,0],loc:n.loc||[0,0]}],range:n.range||[0,0],loc:n.loc||[0,0]},rest:null,generator:!1,expression:!1,range:n.range||[0,0],loc:n.loc||[0,0]}),n}(),i=e.dependencyNames,o=publicAPI.options,s=function(){return"Literal"===a.type||"Identifier"===a.type&&"undefined"===a.name||t===!0?a:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"",range:a.range||[0,0],loc:a.loc||[0,0]},params:r,defaults:[],body:a.body,rest:a.rest,generator:a.generator,expression:a.expression,range:a.range||[0,0],loc:a.loc||[0,0]},arguments:i,range:a.range||[0,0],loc:a.loc||[0,0]}}(),c=function(){return o.globalObject===!0&&o.globalObjectName?{type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:o.globalObjectName,range:a.range||[0,0],loc:a.loc||[0,0]},property:{type:"Literal",value:n,raw:""+n,range:a.range||[0,0],loc:a.loc||[0,0]},range:a.range||[0,0],loc:a.loc||[0,0]},right:s,range:a.range||[0,0],loc:a.loc||[0,0]},range:a.range||[0,0],loc:a.loc||[0,0]}:{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:n,range:a.range||[0,0],loc:a.loc||[0,0]},init:s,range:a.range||[0,0],loc:a.loc||[0,0]}],kind:"var",range:a.range||[0,0],loc:a.loc||[0,0]}}();return c},isRelativeFilePath:function(e){var n=e.split("/");return-1!==n.length&&("."===n[0]||".."===n[0])},normalizeDependencyName:function(e,n){if(!e||!n||!publicAPI.isRelativeFilePath(n))return n;var r=function(e){var n,r=e.split("/");return n=_.reduce(r,function(e,n){switch(n){case".":break;case"..":e.pop();break;default:e.push(n)}return e},[]),n.join("/")},t=function(e){var n=e.split("/");return n.pop(),n.join("/")};return r([t(e),n].join("/"))},convertToFunctionExpression:function(e){var n=e.isDefine,r=e.isRequire,t=!1,a=(e.node,e.moduleName),i=e.moduleId,o=e.dependencies,s=o.length,c=publicAPI.options,l=function(){for(var e,n=[],r=-1;++r<s;)e=publicAPI.normalizeDependencyName(i,o[r]),n.push(c.globalObject===!0&&c.globalObjectName&&"{}"!==e?{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:c.globalObjectName,range:[0,0],loc:[0,0]},property:{type:"Literal",value:publicAPI.normalizeModuleName(e),raw:""+publicAPI.normalizeModuleName(e),range:[0,0],loc:[0,0]},name:publicAPI.normalizeModuleName(e),range:[0,0],loc:[0,0]}:{type:"Identifier",name:publicAPI.normalizeModuleName(e),range:[0,0],loc:[0,0]});return n}(),p=function(){var n,r,a,i,o=e.moduleReturnValue;if(!s&&o&&"FunctionExpression"===o.type&&o.body&&_.isArray(o.body.body)&&o.body.body.length){if(n=_.filter(o.body.body,function(e){return publicAPI.options.removeUseStricts===!0?!publicAPI.isUseStrict(e.expression):e}),r=_.where(n,{type:"ReturnStatement"}),r.length){if(a=r[0],i=a.argument,!publicAPI.isFunctionExpression(a)&&n.length>1||i&&"Identifier"===i.type)return o;o=i,t=!0,o.params&&(s=o.params.length)}}else o&&"FunctionExpression"===o.type&&o.body&&_.isArray(o.body.body)&&0===o.body.body.length&&(o={type:"Identifier",name:"undefined",range:[0,0],loc:[0,0]},s=0);return o}(),u=function(){var e=[];return p&&p.body&&_.isArray(p.body.body)&&(e=_.where(p.body.body,{type:"ReturnStatement"}),e.length)?!0:!1}(),d=!1,m=function(){for(var e,n,r=[],t=-1,a=p.params||[];++t<s;)e=a[t],n=e?e.name:l[t].name,"exports"===n&&(d=!0),"{}"===n&&(n="module"),r.push({type:"Identifier",name:n,range:[0,0],loc:[0,0]});return r}();return!u&&d&&p.body.body.push({type:"ReturnStatement",argument:{type:"Identifier",name:"exports",range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]}),n?publicAPI.convertToIIFEDeclaration({moduleName:a,dependencyNames:l,callbackFuncParams:m,hasExportsParam:d,callbackFunc:p,isOptimized:t}):r?publicAPI.convertToIIFE({dependencyNames:l,callbackFuncParams:m,callbackFunc:p}):void 0},convertDefinesAndRequires:function(e){var n,r,t,a,i,o,s,c,l,p=publicAPI.isDefine(e),u=publicAPI.isRequire(e),d={},m=!1,b="",g=publicAPI.options;if("Program"===e.type&&(c=function(){var n=[];return _.each(e.comments,function(e){var r=e.value.trim();r===g.commentCleanName&&n.push(e)}),n}(),_.each(c,function(e){l=e.loc.start.line,d[l]=!0}),publicAPI.commentLineNumbers=d),s=p||u?e.expression.loc.start.line:e&&e.loc&&e.loc.start?e.loc.start.line:null,publicAPI.commentLineNumbers[s]||publicAPI.commentLineNumbers[""+(parseInt(s,10)-1)])return e;if(publicAPI.isAMDConditional(e))return e.test={type:"Literal",value:!0,raw:"true",range:[0,0],loc:[0,0]},e;if(!p&&!u)return"FunctionExpression"===e.type&&_.isArray(e.params)&&_.where(e.params,{type:"Identifier",name:"exports"}).length&&_.isObject(e.body)&&_.isArray(e.body.body)&&!_.where(e.body.body,{type:"ReturnStatement",argument:{type:"Identifier"}}).length&&(e.body.body.unshift({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:"exports"},right:{type:"LogicalExpression",operator:"||",left:{type:"Identifier",name:"exports"},right:{type:"ObjectExpression",properties:[]}}}}),e.body.body.push({type:"ReturnStatement",argument:{type:"Identifier",name:"exports"},range:[0,0],loc:[0,0]})),e;if(r=Array.prototype.slice.call(e.expression.arguments,0),t=function(){var e=u?r[0]:r[r.length-2],n=[];return e=_.isPlainObject(e)?e.elements||[]:[],Array.isArray(e)&&e.length&&_.each(e,function(e){n.push(publicAPI.dependencyBlacklist[e.value]?"{}":e.value)}),n}(),a=u?r[1]:r[r.length-1],i=e.expression.arguments[0].value,n=publicAPI.normalizeModuleName(i),o={node:e,moduleName:n,moduleId:i,dependencies:t,moduleReturnValue:a,isDefine:p,isRequire:u},p){if(publicAPI.arrayContains(g.removeModules,n))return{type:"EmptyStatement"};if(_.isObject(g.shimOverrides)&&g.shimOverrides[n]&&(o.moduleReturnValue=publicAPI.createAst({code:g.shimOverrides[n]}),_.isArray(o.moduleReturnValue.body)&&_.isObject(o.moduleReturnValue.body[0])?_.isObject(o.moduleReturnValue.body[0].expression)&&(o.moduleReturnValue=o.moduleReturnValue.body[0].expression,b="objectExpression"):o.moduleReturnValue=a),o.moduleReturnValue&&"Identifier"===o.moduleReturnValue.type&&(b="functionExpression"),publicAPI.arrayContains(g.ignoreModules,n))return e;if(publicAPI.isFunctionExpression(a)||"functionExpression"===b)return publicAPI.convertToFunctionExpression(o);if(publicAPI.isObjectExpression(a)||"objectExpression"===b)return publicAPI.convertToObjectDeclaration(o);if(publicAPI.isFunctionCallExpression(a))return publicAPI.convertToObjectDeclaration(o,"functionCallExpression")}else if(u)return m=_.isArray(e.expression.arguments)&&e.expression.arguments.length?e.expression.arguments[1]&&e.expression.arguments[1].body&&e.expression.arguments[1].body.body&&e.expression.arguments[1].body.body.length:!1,g.removeAllRequires!==!0&&m?publicAPI.convertToFunctionExpression(o):{type:"EmptyStatement"}},createAst:function(e){var n=e.filePath,r=e.code||(n&&"node"===publicAPI.env?publicAPI.readFile(n):""),t=publicAPI.options.esprima;if(r){if(!_.isPlainObject(esprima)||!_.isFunction(esprima.parse))throw new Error(publicAPI.errorMsgs.esprima);return esprima.parse(r,t)}throw new Error(publicAPI.errorMsgs.emptyCode)},traverseAndUpdateAst:function(e){if(!_.isPlainObject(e))throw new Error(publicAPI.errorMsgs.invalidObject("traverseAndUpdateAst"));var n=e.ast,r=function(e,n){return publicAPI.convertDefinesAndRequires(e,n)},t=function(e){return e},a=_.isFunction(e.enterFunc)?e.enterFunc:r,i=_.isFunction(e.leaveFunc)?e.leaveFunc:t;if(!n)throw new Error(publicAPI.errorMsgs.emptyAst("traverseAndUpdateAst"));if(!_.isPlainObject(estraverse)||!_.isFunction(estraverse.replace))throw new Error(publicAPI.errorMsgs.estraverse);return estraverse.replace(n,{enter:a,leave:i}),n},generateCode:function(e,n){var r=n.esprima||{},t=n.escodegen||{};if(!_.isPlainObject(escodegen)||!_.isFunction(escodegen.generate))throw new Error(publicAPI.errorMsgs.escodegen);if(r.comment===!0&&t.comment===!0)try{e=escodegen.attachComments(e,e.comments,e.tokens)}catch(a){console.log("There was an error attaching comments: ",a)}return escodegen.generate(e,t)},clean:function(e){var n,r={},t={},a={},i=_.cloneDeep(publicAPI.defaultOptions||{}),o=e||{},s=_.merge(i,o);if(publicAPI.options=a=s,!_||!_.isPlainObject)throw new Error(publicAPI.errorMsgs.lodash);if(!_.isPlainObject(e)&&_.isString(e))r.code=e;else{if(!_.isPlainObject(e))throw new Error(publicAPI.errorMsgs.invalidObject("clean"));r=e}return t=publicAPI.traverseAndUpdateAst({ast:publicAPI.createAst(r)}),t&&_.isArray(t.body)&&estraverse.replace(t,{enter:function(e,n){var r;if(void 0===e||"EmptyStatement"===e.type)_.each(n.body,function(e,r){(void 0===e||"EmptyStatement"===e.type)&&n.body.splice(r,1)});else if(publicAPI.isRequireExpression(e))return e.arguments&&e.arguments[0]&&e.arguments[0].value?(r=publicAPI.normalizeModuleName(e.arguments[0].value),a.globalObject===!0&&a.globalObjectName&&_.isString(a.globalObjectName)&&a.globalObjectName.length?{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:a.globalObjectName,range:[0,0],loc:[0,0]},property:{type:"Literal",value:r,raw:r,range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]}:{type:"Identifier",name:r,range:[0,0],loc:[0,0]}):e}}),_.isArray(a.globalModules)&&_.each(a.globalModules,function(e){_.isString(e)&&e.length&&t.body.push({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"window",range:[0,0],loc:[0,0]},property:{type:"Identifier",name:e,range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]},right:{type:"Identifier",name:e,range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]})}),a.globalObject===!0&&a.globalObjectName&&!publicAPI.createdGlobalObject&&(a.rememberGlobalObject===!0&&(publicAPI.createdGlobalObject=!0),t.body.unshift({type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:a.globalObjectName,range:[0,0],loc:[0,0]},init:{type:"ObjectExpression",properties:[],range:[0,0],loc:[0,0]},range:[0,0],loc:[0,0]}],kind:"var",range:[0,0],loc:[0,0]})),n=publicAPI.generateCode(t,a),_.isObject(publicAPI.options.wrap)&&(_.isString(publicAPI.options.wrap.start)&&publicAPI.options.wrap.start.length&&(n=publicAPI.options.wrap.start+n),_.isString(publicAPI.options.wrap.end)&&publicAPI.options.wrap.end.length&&(n+=publicAPI.options.wrap.end)),n}};return publicAPI});